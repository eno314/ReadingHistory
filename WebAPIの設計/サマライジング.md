# Web API の設計 サマライジング

## 装丁読み

- Web API
- 設計
- ユーザブル
- セキュア
- 効率的
- 進化可能
- Web API をデザイン
- 知っておくべきこと
- 第1部 APIデザインの基礎
  - 第1章 APIデザインとは何か
  - 第2章 ユーザーを意識したAPIを設計する
  - 第3章 プログラミングインタフェイスを設計する
  - 第4章 API記述フォーマットを使ってAPIを記述する
- 第2部 ユーザブルなAPIの設計
  - 第5章 単純明快なAPIを設計する
  - 第6章 予測可能なAPIを設計する
  - 第7章 うまく整理された簡潔なAPIを設計する
- 第3部 コンテキストに応じたAPIデザイン
  - 第8章 セキュアなAPIを設計する
  - 第9章 APIの設計を進化させる
  - 第10章 ネットワーク効率のよいAPIを設計する
  - 第11章 コンテキストに基づいてAPIを設計する
  - 第12章 APIを文書化する
  - 第13章 APIを成長させる

## 本書に寄せて

- 本書は次世代のAPIデザインガイダンスの第一波
  - RESTからの脱却
  - RESTに根ざしているが、独断的な考えはなく、現実世界のAPIデザインの知識を提供
- 単にAPIを設計するだけでなく、対象となる利用者を思いやりながら、APIを提供するという行為にもフォーカスしている
- APIデザインとOpenAPIを実践的な方法で融合

## まえがき

- ソフトウェアインターフェイスは、技術的なパイプやソフトウェアプロジェクトの副産物を遥かに超える存在である
- REST API に焦点を合わせている
- 単なるAPIの設計の枠を超えて、WebAPIとリモートAPIの設計原則を学ぶための見本

## 本書について

- 明確に表現されたニーズに応えるだけではなく、それ以上のことを行う Web API の設計を手助けする
  - さまざまなコンテキストで誰でも使うことができる
  - セキュア
  - 持続可能
  - 進化可能
  - 効率的
  - 実装可能
- Web API のエコシステムと API の設計者がこのエコシステムをどのように貢献できるのかを詳しく説明

## 第1部 APIデザインの基礎

- APIの設計に必要な、最も基本的な概念とスキルについて
- APIは、ユーザーが自分の目標を簡単に達成できるようにするためのもの
- インターフェイスの記述は、REST API 用のOpenAPISpecification(OAS)のような適切なツールを使って行うべき

### 第1章 APIデザインとは何か

- APIとは何か
  - アプリケーションを構築する開発者のためのインターフェイス
  - Web APIにより、ソフトウェアは再利用可能なブロックとなり、HTTPプロトコルを使ってネットワーク経由で利用できる
- APIの設計はなぜ重要なのか
  - パブリック・プラベート問わず、すべてのAPIとって設計は重要
  - うまく設計されていないAPIは、「十分に活用されない」「正しく使われない」「全く使われない」「安全でない」ということがある
- APIの設計を構成する要素はなにか
  - アプリケーションの全体像を考慮に入れる

### 第2章 ユーザーを意識したAPIを設計する

- APIの(本当の)目的を正確に見極める方法
  - APIのユーザーと、そのAPIを利用するソフトウェアの視点に焦点を合わせる
  - APIを提供している組織やソフトウェアの視点を回避する
- APIの設計時に重視すべき点
  - コンシューマ(APIを利用するアプリケーション)の視点に立って設計する
- APIの本当の目標を正確に判断する方法
  - 以下のような内容を特定し、包括的なAPIのゴールリストを構築する
  - 「ユーザーは誰か」「何ができるか」「それをどのように行うか」「そのために何が必要か」「何が返ってくるか」

### 第3章 プログラミングインタフェイスを設計する

- HTTPプロトコル、REST API、REST アーキテクチャスタイルを紹介
- 特定されたゴールに基づいてWebプログラミングインターフェイスを設計する方法を紹介

- APIのゴールをプログラミングインターフェイスに置き換える
- RESTのリソースとアクションを特定し、マッピングする
- リソースに基づいてAPIのデータを設計する
- REST API と RESTアーキテクチャスタイルを区別する
- RESTアーキテクチャスタイルがは、なぜAPIの設計にとって重要か

- REST API : リソース(パス)でのアクション(HTTPメソッド)を使って、ゴールを表す
- データを設計する際は、「object」「array」「string」「number」「date」「boolean」等の移植可能な型を使わなければならない
- 1つのリソースに対する複数のデータ表現を、コンテキストに応じて使い分けることができる
- コンシューマが提供できないデータがパラメータに含まれているとしたら、何かを見落としている
- 設計時に、設計上の課題にぶつかっては妥協点を探ることになるのは、至って普通のこと

### 第4章 API記述フォーマットを使ってAPIを記述する

- API記述フォーマット
  - プログラミングインターフェイスを記述して、共有するためのシンプルで構造化された手法
  - マシンリーダブルなドキュメントであり、APIリファレンスドキュメントの生成を含め、さまざまな方法で利用できる
  - 利用シーン : APIのプログラム可能な表現とデータを設計するとき
  - できる限り活用し、効率よく利用できるように、詳しく調べてみるといい
- OpenAPI Specification を紹介
- API記述フォーマットを使って構造化された標準的な方法で、APIを記述する具体的な方法を示す

## 第2部 ユーザブルなAPIの設計

- 考えさせない(理解しやすく使いやすい) API の設計方法
- APIの利用者のことを考えたAPIにするなら、利用者に頭を使わせない単純明快な設計のAPIにするべき
  - データ、ゴール、エラーフィードバックを理解しやすい
  - コンパクトに整理されている
  - 安心してAPIを使うことができる
  - 設計が標準や一般的なプラクティスに従っている

### 第5章 単純明快なAPIを設計する

- 単純明快な(すぐに理解でき、簡単に使える)データ表現、エラーと成功のフィードバック、API呼び出しのフローを設計する方法
- 概念を単純明快にする
  - すべての表現を人間とプログラムの両方が簡単に理解できるものにする
  - できるだけ情報価値のある表現にする
- エラーと成功のフィードバックを特定する
  - エラーのフィードバックには、問題を理解して、可能であれば修正するのに十分な要素を提供しなければならない
  - 成功のフィードバックには、何が完了したのかを説明しなければならない
- 使用のフローが効率的になるように設計する
  - ゴールフローは、エラーを回避するデータやゴールを追加することによって最適化できる
  - ゴールフローは、ゴールを集約することによって簡略化できるが、機能的な観点から妥当である場合に限られる


### 第6章 予測可能なAPIを設計する

- さらに理解しやすく使いやすいAPIを設計する方法
  - 一貫性がある、適応可能、発見可能
- 一貫性
  - 直感的な API の設計を終始心がける
  - 規約の定義と、共通のプラクティスや規格へ準拠する
- 適応可能
  - ユーザーに適応する使いやすい機能を追加する
  - 使いやすくするだけでなく、より単純な設計にする
  - APIのニーズを常にチェックして、必要があればさまざまな表現や国際化/地域化機能を提供する
  - リストを扱う場合は、ページング・フィルタリング・ソートがあると、APIユーザーが便利か検討する
- 発見可能
  - ユーザーのガイドとなるメタデータとメタゴールを追加する(ハイパーメディアリンクみたいなもの)
  - APIが予測可能か常に意識しつつ、複雑な機能や不要な機能は追加しない

### 第7章 うまく整理された簡潔なAPIを設計する

- APIを理解しやすく使いやすい状態を保つためには、整理整頓が重要
  - 要素が論理的にグループ化/ソートされていると、要素を探すのと目的を理解するのが容易になる
  - データ(リクエストやレスポンス)
    - グループ化して、重要度が高い順に上から並べる
    - データ構造のプロパティの数と深さは最小限に保つ
  - フィードバック
    - APIのベースとなっているプロトコルのフィードバック構成(RESTならステータスコード等)をうまく利用する
    - カスタムフィードバックを定義して、解釈を容易にする
    - 複数のエラーがあった場合、重要なものから順に並べる
  - ゴール(エントリポイント)
    - 表現ではなく、機能に焦点をあわせて、ゴールをグループ化する
    - API記述フォーマットの機能や、命名パターン(OpenAPIのタグやURLのプレフィックス等)を使ってグループ化する
- データ構造、ゴール、API自体を、より小さく、機能的に重要な要素に分割する

## 第3部 コンテキストに応じたAPIデザイン

- 1部と2部 : コンシューマにとって意味のあるAPIを設計する
  - コンシューマにとって意味のあるAPI : APIのことをわざわざ考えることが無いほど、理解しやすく、使いやすい API
  - とはいえ、APIを設計するために必要なことは、これだけではない
  - では他に何が必要なのか -> APIを取り巻くコンテキスト全体を考慮に入れる必要がある
- API設計者が考慮しないといけないコンテキスト
  - セキュリティ : APIは最初からセキュアである必要がある
  - 進化 : APIは生き物で、後戻りできないほど進化していくもの。破壊的変更が追加されないように最新の注意を払う
  - ネットワーク : クライアントがモバイルの場合の考慮や、ネットワークの通信効率が重要な制約になる場合の対応
  - APIの設計者の仕事は、APIの設計だけではない -> ドキュメントも設計者が設計の段階から作る & 直接関わっていないAPIでも、同じ組織内なら積極的に協力する

### 第8章 セキュアなAPIを設計する

- APIのセキュリティとセキュアなAPIの設計方法
- 攻撃対象領域を最小限に抑えることが、APIのセキュリティに大きな貢献になる
  - APIは本当に必要なものだけを公開・要求する
  - コンシューマ毎に、本当に必要なものだけしか使えないようにする
  - 「アクセス制御 + 必要なデータ」を念頭に置いた上で、ユーザーの視点に立ってAPIを設計する
- 何をセンシティブなデータ・ゴールと見なすかは明白ではないこともあるので、技術・セキュリティ・ビジネス・法律の専門家に助けてもらいながら、センシティブなものを特定する
- APIのベースとなっているプロトコルやアーキテクチャにも、データ漏洩の可能性があることを意識して、注意を払う必要がある

### 第9章 APIの設計を進化させる

- ユーザーに不当な影響を与えることなく、APIを変更・バージョニング方法
- 進化しやすいAPIを最初から設計する方法

### 第10章 ネットワーク効率のよいAPIを設計する

-

### 第11章 コンテキストに基づいてAPIを設計する

- API設計者が考慮しないといけない、コンテキスト全体を明らかにする
  - 通信メカニズムの適応
  - コンシューマまたはプロバイダの制限の評価と適応
  - 適切なAPIスタイルの選択

### 第12章 APIを文書化する

- API設計者が、API記述フォーマットを活用することで、さまざまな種類のAPIドキュメント作成にどのように関与するのかについて説明

### 第13章 APIを成長させる

- APIの設計者がAPIのライフサイクル全体とさまざまなAPIに関与することで、多くのAPIの成長にどのように貢献できるのか
- APIの設計ガイドラインと、APIのレビューにフォーカス
