# テスト駆動Python

## 経緯

- pythonのテストの書き方を学びたい
- 他の言語のテストコードの書き方で参考になる部分があったら取り入れたい

## 感想

原作のタイトルが「Python Testing with pytest」とあなっているので、もともとはpytestの解説本。pytestの使い方を詳しく知りたい。テスト駆動開発はおまけ程度。として読めば、良いかなと思う。

## 各章のメモ

### 1章

pytestコマンドの使い方を紹介するの章だった。

知らないオプションが結構あったので、それを知ることができてよかった。あとから使えそうなオプションやコマンドにはマーカーを引いておいたので、コマンド参照したいときは、マーカーをみるようにしよう。

### 2章

- 例外キャッチするテストやったことがなかったから、これで練習できてよかった。
- 簡単なフィクスチャを試せたのが良かった。
  - 1つのメソッドでsetupとteardownが書けるのは良い
- parametrizeの詳細な使い方も知れた
  - idを付けることができる
  - クラスに付けるとインスタンスメソッドで使える

### 3章

- GIVENの内容をできるだけフィクスチャとして表現するというのは自分でも実践してみたい
- フィクスチャの実行タイミングを制御するにはscopeのパラメータを使うというのは良く使いそうだから覚えておきたい
- データフィクスチャは値を返すだけなので、セッションごとに1度実行すれば一度実行すればいい、というのはこれを読まなかったら気づかなかった
- `pytest.mark.usefixtures`のアノテーションでもフィクスチャを呼び出せるが、戻り値を使用できない
  - 戻り値を使いたい場合はパラメータでフィクスチャを指定する（間違えそうなので気をつけたい）

### 4章

- tmpdirとtmpdir_factoryの使い分け
  - tmpdirは関数スコープ（1つのテスト内でのみ利用する）
  - tmpdir_factoryはセッションスコープ（複数のテストで共有する）
- capsysは便利だな。標準出力のテストができると、paizaとかatcoderのテストも書きやすい気がする
- monkeypatchはライブラリのメソッドを置き換えたりするのに使うのが良いのかな？モックと合わせてどう使うので、7章でちゃんと見ていきたい、
- doctestは補完が効けば良い感じだな

### 5章

pytext.configがpytestの5系から削除されたみたいで、5.4のコードが上手く動かなかった。代わりに`request.config`か`pytest_configure(config)`を使うのがいいみたい。

<https://docs.pytest.org/en/latest/deprecations.html#pytest-config-global>

### 6章

- 著者が使っている`pytest.ini`の設定は自分も使う
- `__init__.py`を容易すれば、同じファイル名があってもディレクトリが違えば大丈夫になる
  - 基本、入れておくのが良さそう
